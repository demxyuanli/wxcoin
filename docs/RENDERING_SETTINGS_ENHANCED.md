# 渲染设置功能说明（增强版）

## 功能概述

渲染设置功能为3D CAD应用程序提供了完整的材质、光照和纹理配置界面，支持预设材质和图片纹理贴图。该功能包括一个带有三个标签页的对话框，支持配置文件持久化存储，并提供实时预览功能。

## 新增功能

### 1. 预设材质系统
- **12种预设材质**: 玻璃、金属、塑料、木材、陶瓷、橡胶、铬合金、黄金、白银、铜、铝合金
- **自定义材质**: 支持手动调整材质参数
- **一键应用**: 选择预设材质后自动应用所有相关参数

### 2. 图片纹理贴图
- **图片格式支持**: PNG、JPG、JPEG、BMP、TGA、TIFF
- **纹理预览**: 64x64像素的实时预览
- **文件路径显示**: 显示当前选择的纹理文件名
- **自动回退**: 图片加载失败时自动使用颜色纹理

## 主要特性

### 1. 材质设置
- **材质预设下拉框**: 快速选择常用材质类型
- **环境光颜色 (Ambient Color)**: 控制物体在阴影区域的基础颜色
- **漫反射颜色 (Diffuse Color)**: 控制物体在直接光照下的主要颜色
- **镜面反射颜色 (Specular Color)**: 控制物体高光反射的颜色
- **光泽度 (Shininess)**: 控制镜面反射的锐利程度 (0-128)
- **透明度 (Transparency)**: 控制物体的透明程度 (0-100%)

### 2. 光照设置
- **环境光颜色 (Ambient Light Color)**: 控制场景整体的基础照明颜色
- **漫反射光颜色 (Diffuse Light Color)**: 控制主光源的颜色
- **镜面反射光颜色 (Specular Light Color)**: 控制光源高光的颜色
- **光照强度 (Light Intensity)**: 控制主光源的亮度 (0-200%)
- **环境光强度 (Ambient Intensity)**: 控制环境光的强度 (0-100%)

### 3. 纹理设置
- **图片纹理选择**: 支持从文件系统选择纹理图片
- **纹理预览**: 实时预览选择的纹理图片
- **纹理颜色 (Texture Color)**: 控制纹理的基础颜色（无图片时使用）
- **纹理强度 (Texture Intensity)**: 控制纹理效果的强度 (0-100%)
- **启用纹理 (Enable Texture)**: 开启或关闭纹理效果

## 预设材质详细说明

### 玻璃材质
- **特点**: 高透明度、高光泽度、浅蓝色调
- **透明度**: 70%
- **光泽度**: 128（最高）
- **适用场景**: 窗户、容器、光学元件

### 金属材质
- **特点**: 高反射、中等光泽度、灰色调
- **透明度**: 0%（不透明）
- **光泽度**: 80
- **适用场景**: 机械零件、工具、结构件

### 塑料材质
- **特点**: 中等光泽度、鲜艳色彩、不透明
- **透明度**: 0%
- **光泽度**: 32
- **适用场景**: 外壳、装饰件、日用品

### 木材材质
- **特点**: 低光泽度、棕色调、自然质感
- **透明度**: 0%
- **光泽度**: 16（较低）
- **适用场景**: 家具、建筑材料、装饰品

### 陶瓷材质
- **特点**: 高光泽度、米白色调、光滑表面
- **透明度**: 0%
- **光泽度**: 64
- **适用场景**: 餐具、装饰品、工艺品

### 橡胶材质
- **特点**: 极低光泽度、深色调、哑光效果
- **透明度**: 0%
- **光泽度**: 4（最低）
- **适用场景**: 密封件、轮胎、防滑材料

### 铬合金材质
- **特点**: 极高光泽度、明亮反射、镜面效果
- **透明度**: 0%
- **光泽度**: 128（最高）
- **适用场景**: 装饰件、汽车配件、精密仪器

### 黄金材质
- **特点**: 金黄色调、高光泽度、贵金属质感
- **透明度**: 0%
- **光泽度**: 64
- **适用场景**: 首饰、装饰品、奢侈品

### 白银材质
- **特点**: 银白色调、高光泽度、金属质感
- **透明度**: 0%
- **光泽度**: 64
- **适用场景**: 首饰、餐具、电子元件

### 铜材质
- **特点**: 铜红色调、中等光泽度、暖色金属
- **透明度**: 0%
- **光泽度**: 64
- **适用场景**: 管道、电线、艺术品

### 铝合金材质
- **特点**: 浅灰色调、高光泽度、轻质金属
- **透明度**: 0%
- **光泽度**: 96
- **适用场景**: 航空航天、汽车、建筑

## 使用方法

### 打开渲染设置对话框
1. 在主界面工具栏中找到"渲染设置"按钮
2. 点击按钮打开渲染设置对话框
3. 对话框包含三个标签页：材质、光照、纹理

### 使用预设材质
1. 在材质标签页中找到"材质预设"下拉框
2. 选择所需的预设材质（如"玻璃"、"金属"等）
3. 系统会自动应用预设的所有材质参数
4. 如需微调，可以手动调整各项参数（此时预设会变为"自定义"）

### 使用图片纹理
1. 在纹理标签页中点击"选择图片..."按钮
2. 在文件对话框中选择纹理图片文件
3. 系统会显示64x64像素的纹理预览
4. 文件路径会显示在预览下方
5. 调整纹理强度滑块控制纹理效果强度
6. 勾选"启用纹理"复选框应用纹理效果

### 保存和应用设置
1. **实时预览**: 点击"应用"按钮查看效果
2. **自动保存**: 所有设置更改会自动保存到配置文件
3. **重置功能**: 点击"重置为默认值"恢复初始设置
4. **持久化**: 下次启动应用程序时会自动加载上次的设置

## 技术实现

### 核心组件扩展

#### 1. RenderingConfig 增强
- **预设材质定义**: 内置12种材质预设的完整参数
- **图片路径支持**: TextureSettings结构体新增imagePath字段
- **预设管理方法**: 提供预设枚举、名称转换、应用等方法

#### 2. RenderingSettingsDialog 增强
- **材质预设下拉框**: wxChoice控件选择预设材质
- **图片选择按钮**: wxButton控件打开文件对话框
- **纹理预览控件**: wxStaticBitmap显示64x64纹理预览
- **路径显示标签**: wxStaticText显示当前纹理文件路径

#### 3. OCCGeometry 增强
- **图片纹理加载**: 支持从文件系统加载各种格式的纹理图片
- **智能回退机制**: 图片加载失败时自动使用颜色纹理
- **纹理路径存储**: 新增m_textureImagePath成员变量

### 新增数据结构

#### MaterialPreset 枚举
```cpp
enum class MaterialPreset {
    Custom,     // 自定义
    Glass,      // 玻璃
    Metal,      // 金属
    Plastic,    // 塑料
    Wood,       // 木材
    Ceramic,    // 陶瓷
    Rubber,     // 橡胶
    Chrome,     // 铬合金
    Gold,       // 黄金
    Silver,     // 白银
    Copper,     // 铜
    Aluminum    // 铝合金
};
```

#### TextureSettings 扩展
```cpp
struct TextureSettings {
    Quantity_Color color;        // 纹理颜色
    double intensity;            // 纹理强度
    bool enabled;               // 是否启用
    std::string imagePath;      // 图片文件路径（新增）
};
```

## 配置文件格式更新

### rendering_settings.ini 示例
```ini
[Material]
AmbientColorR=0.200000
AmbientColorG=0.200000
AmbientColorB=0.200000
DiffuseColorR=0.680000
DiffuseColorG=0.850000
DiffuseColorB=1.000000
SpecularColorR=0.900000
SpecularColorG=0.900000
SpecularColorB=0.900000
Shininess=60.000000
Transparency=0.000000

[Lighting]
AmbientColorR=0.200000
AmbientColorG=0.200000
AmbientColorB=0.200000
DiffuseColorR=1.000000
DiffuseColorG=1.000000
DiffuseColorB=1.000000
SpecularColorR=1.000000
SpecularColorG=1.000000
SpecularColorB=1.000000
Intensity=1.000000
AmbientIntensity=0.200000

[Texture]
Color=1.000000,1.000000,1.000000
Intensity=0.500000
Enabled=false
ImagePath=C:\Textures\wood_grain.jpg
```

## 支持的图片格式

### 推荐格式
- **PNG**: 支持透明度，质量高，适合复杂纹理
- **JPG/JPEG**: 文件小，适合照片纹理
- **BMP**: 无压缩，质量最高，文件较大

### 其他支持格式
- **TGA**: 游戏开发常用，支持透明度
- **TIFF**: 高质量，支持多层，文件较大

### 纹理建议
- **分辨率**: 推荐使用2的幂次方尺寸（如256x256、512x512）
- **文件大小**: 建议小于10MB以确保加载性能
- **颜色深度**: 支持8位和24位颜色深度

## 性能优化

### 纹理加载优化
- **延迟加载**: 仅在需要时加载纹理图片
- **缓存机制**: 避免重复加载相同纹理
- **格式转换**: 自动转换为OpenGL兼容格式

### 预设材质优化
- **静态初始化**: 预设材质参数在程序启动时初始化
- **内存共享**: 多个对象可以共享相同的预设材质
- **快速切换**: 预设切换无需重新计算参数

## 故障排除

### 常见问题
1. **纹理不显示**: 检查图片文件是否存在且格式支持
2. **预设材质无效**: 确认预设名称正确且系统已初始化
3. **配置文件损坏**: 删除配置文件让系统重新创建
4. **图片加载失败**: 检查文件路径和权限

### 调试建议
1. 查看日志文件了解纹理加载状态
2. 验证图片文件格式和完整性
3. 检查系统OpenGL版本是否支持纹理功能
4. 确认文件路径中无特殊字符

## 扩展建议

### 未来增强
1. **程序化纹理**: 支持数学生成的纹理模式
2. **法线贴图**: 添加法线贴图支持以增强表面细节
3. **多纹理混合**: 支持多个纹理层的混合效果
4. **动态纹理**: 支持动画纹理和视频纹理
5. **材质库**: 建立可扩展的材质库系统

### 用户体验改进
1. **拖拽支持**: 支持拖拽图片文件到纹理区域
2. **批量应用**: 支持将设置应用到多个对象
3. **材质预览球**: 添加3D预览球显示材质效果
4. **导入导出**: 支持材质设置的导入导出功能

## 版本历史

### v2.0 (当前版本)
- 新增12种预设材质
- 支持图片纹理贴图
- 增强的用户界面
- 配置文件格式扩展
- 性能优化和错误处理

### v1.0 (基础版本)
- 基础材质、光照、纹理设置功能
- 配置文件持久化存储
- 实时预览和应用功能
- 默认值和重置功能

---

*本文档描述了渲染设置功能的增强版实现，包括预设材质系统和图片纹理贴图功能。如有问题或建议，请联系开发团队。* 
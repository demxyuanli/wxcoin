# 性能优化总结

## 问题描述
- Canvas 鼠标操作卡顿
- 虽然功能正常，但用户体验不佳

## 识别的性能问题

### 1. 进度定时器持续运行
- **问题**：`m_progressTimer` 每 50ms 触发一次，即使没有进行 feature edge 生成
- **影响**：持续的 CPU 占用和 UI 更新
- **解决**：修改定时器逻辑，只在需要时运行，并在任务完成后自动停止

### 2. onSize 事件中的过度刷新
- **问题**：每次窗口大小改变都调用 `Refresh()`
- **影响**：频繁的整个 docking 容器重绘
- **解决**：移除不必要的 `Refresh()` 调用，让 docking 系统自己处理布局更新

### 3. Canvas 初始化时的多次刷新
- **问题**：在 reparent 和设置连接后都调用 `Refresh(true)` 和 `Update()`
- **影响**：不必要的多次 OpenGL 上下文切换和渲染
- **解决**：移除多余的刷新调用

### 4. UPDATE_UI 事件频率
- **问题**：多个 `EVT_UPDATE_UI` 事件处理器
- **影响**：这些事件在空闲时频繁触发
- **建议**：考虑使用更高效的状态管理方式

## 实施的优化

1. **定时器优化**
   - 修改进度定时器为按需启动
   - 在没有任务时自动停止

2. **减少刷新调用**
   - 移除 `onSize` 中的 `Refresh()`
   - 移除 Canvas 初始化后的强制刷新

3. **事件处理优化**
   - 让系统自行管理布局和渲染更新

## 预期效果
- 减少 CPU 占用
- 更流畅的鼠标响应
- 更好的整体性能

## 进一步优化建议

1. **渲染优化**
   - 考虑实现脏区域渲染
   - 使用 LOD (Level of Detail) 技术

2. **事件优化**
   - 将 UPDATE_UI 事件替换为按需更新
   - 实现事件批处理

3. **OpenGL 优化**
   - 确保使用硬件加速
   - 优化渲染管线